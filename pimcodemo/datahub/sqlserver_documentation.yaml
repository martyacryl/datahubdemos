# PIMCO Municipal Bond Demo - SQL Server Documentation
# Comprehensive documentation for SQL Server source system tables and stored procedures

tables:
  # ============================================================================
  # SQL SERVER SOURCE TABLES - Opaque Numeric Names (System-Database Style)
  # ============================================================================
  
  - table: "dbo.TBL_0421"
    description: |
      Source transaction data table in SQL Server. Contains raw bond transaction records 
      from trading systems before transformation. This is the source system table that 
      feeds into Snowflake Bronze layer via Fivetran ETL.
      
      **Purpose**: Source of truth for bond transactions in SQL Server. Data is transformed 
      by stored procedures and then extracted by Fivetran to load into Snowflake.
      
      **Data Flow**: 
      - Source: Trading systems (external feeds)
      - Transformation: Stored procedure sp_LoadTBL_0421 transforms data
      - Extraction: Fivetran extracts from this table
      - Destination: Loaded into Snowflake BRZ_001.TX_0421 via Fivetran
      
      **Key Characteristics**:
      - Contains opaque trade type codes (e.g., 'B', 'S', '1', '2')
      - Includes raw JSON data in RAW_DATA column
      - Trade dates and settlement dates for trade lifecycle tracking
      - Principal amounts represent par value of bonds traded
      - Opaque numeric table name (TBL_0421) matches system-database naming convention
    business_purpose: |
      Source system table for bond transactions. Maintains original data formats 
      and opaque codes from trading systems before ETL transformation.
    data_lineage: |
      Trading Systems → sp_LoadTBL_0421 → dbo.TBL_0421 → Fivetran → BRZ_001.TX_0421
    usage_notes: |
      - Source table for transaction data
      - Used by stored procedure sp_LoadTBL_0421 for transformation
      - Extracted by Fivetran for Snowflake loading
      - Maps to Snowflake BRZ_001.TX_0421
    columns:
      TX_ID:
        description: "Unique transaction identifier from source system"
        data_type: "VARCHAR(50)"
        business_meaning: "Transaction identifier from trading system"
        
      TD_DATE:
        description: "Trade date - when the bond trade was executed"
        data_type: "DATE"
        business_meaning: "Date when trade executed"
        
      STL_DATE:
        description: "Settlement date - when the trade settles"
        data_type: "DATE"
        business_meaning: "Date when trade settles"
        
      PRN_AMT:
        description: "Principal amount - the par value of bonds traded"
        data_type: "DECIMAL(18, 2)"
        business_meaning: "Par value of bonds traded"
        glossary_term: "Par Value"
        
      ISS_ID:
        description: "Issuer identifier - links to issuer dimension"
        data_type: "VARCHAR(50)"
        business_meaning: "Issuer identifier"
        glossary_term: "Bond Issuer"
        
      BND_ID:
        description: "Bond identifier - links to bond reference data"
        data_type: "VARCHAR(50)"
        business_meaning: "Bond identifier"
        
      TRD_TYPE:
        description: "Trade type - opaque code from source system (B, S, 1, 2)"
        data_type: "VARCHAR(10)"
        business_meaning: "Opaque code for trade direction"
        glossary_term: "Bond Transaction"
        
      CUSIP:
        description: "CUSIP identifier for the bond"
        data_type: "VARCHAR(9)"
        business_meaning: "Standard bond identifier"
        
      RAW_DATA:
        description: "Raw JSON data from source system"
        data_type: "VARCHAR(MAX)"
        business_meaning: "Flexible storage for source system metadata"
        
  - table: "dbo.TBL_7832"
    description: |
      Source bond reference data table in SQL Server. Contains bond characteristics 
      including maturity date, coupon rate, credit rating, and issuer type.
      
      **Purpose**: Source of truth for bond reference data in SQL Server. Data is 
      transformed by stored procedures and then extracted by Fivetran to load into Snowflake.
      
      **Data Flow**:
      - Source: Bond reference data systems
      - Transformation: Stored procedure sp_LoadTBL_7832 transforms data
      - Extraction: Fivetran extracts from this table
      - Destination: Loaded into Snowflake BRZ_001.REF_7832 via Fivetran
      
      **Key Characteristics**:
      - Contains opaque issuer type codes (e.g., 'E', 'T', '1', '0', 'N', 'Y')
      - Includes standard bond identifiers (CUSIP, ISIN)
      - Credit ratings from rating agencies
      - Bond characteristics for portfolio analysis
      - Opaque numeric table name (TBL_7832) matches system-database naming convention
    business_purpose: |
      Source system table for bond reference data. Maintains original data formats 
      and opaque codes from reference data systems before ETL transformation.
    data_lineage: |
      Bond Reference Systems → sp_LoadTBL_7832 → dbo.TBL_7832 → Fivetran → BRZ_001.REF_7832
    usage_notes: |
      - Source table for bond reference data
      - Used by stored procedure sp_LoadTBL_7832 for transformation
      - Extracted by Fivetran for Snowflake loading
      - Maps to Snowflake BRZ_001.REF_7832
    columns:
      BND_ID:
        description: "Unique bond identifier from source system"
        data_type: "VARCHAR(50)"
        business_meaning: "Bond identifier"
        
      CUSIP:
        description: "CUSIP identifier for the bond"
        data_type: "VARCHAR(9)"
        business_meaning: "Standard bond identifier"
        
      ISIN:
        description: "ISIN identifier for the bond"
        data_type: "VARCHAR(20)"
        business_meaning: "International bond identifier"
        
      MAT_DATE:
        description: "Maturity date - when bond principal is repaid"
        data_type: "DATE"
        business_meaning: "Date when bond reaches maturity"
        glossary_term: "Maturity Date"
        
      CPN_RATE:
        description: "Coupon rate - annual interest rate as percentage"
        data_type: "DECIMAL(5, 3)"
        business_meaning: "Annual interest rate"
        glossary_term: "Coupon Rate"
        
      CR_RT:
        description: "Credit rating - bond issuer creditworthiness rating"
        data_type: "VARCHAR(5)"
        business_meaning: "Credit risk rating"
        glossary_term: "Credit Rating"
        
      ISS_TYPE:
        description: "Issuer type - opaque code from source system (E, T, 1, 0, N, Y)"
        data_type: "VARCHAR(50)"
        business_meaning: "Opaque code for issuer classification"
        
      RAW_DESC:
        description: "Raw JSON description from source system"
        data_type: "VARCHAR(MAX)"
        business_meaning: "Flexible storage for source system metadata"
        
  - table: "dbo.TBL_5510"
    description: |
      Source issuer information table in SQL Server. Contains issuer name, type, 
      state, and municipality details.
      
      **Purpose**: Source of truth for bond issuer information in SQL Server. Data is 
      transformed by stored procedures and then extracted by Fivetran to load into Snowflake.
      
      **Data Flow**:
      - Source: Issuer reference data systems
      - Transformation: Stored procedure sp_LoadTBL_5510 transforms data
      - Extraction: Fivetran extracts from this table
      - Destination: Loaded into Snowflake BRZ_001.ISS_5510 via Fivetran
      
      **Key Characteristics**:
      - Contains issuer names and geographic information
      - Includes opaque issuer type codes
      - State and municipality information for geographic analysis
      - Opaque numeric table name (TBL_5510) matches system-database naming convention
    business_purpose: |
      Source system table for bond issuer information. Maintains original data formats 
      and opaque codes from issuer reference systems before ETL transformation.
    data_lineage: |
      Issuer Reference Systems → sp_LoadTBL_5510 → dbo.TBL_5510 → Fivetran → BRZ_001.ISS_5510
    usage_notes: |
      - Source table for issuer information
      - Used by stored procedure sp_LoadTBL_5510 for transformation
      - Extracted by Fivetran for Snowflake loading
      - Maps to Snowflake BRZ_001.ISS_5510
    columns:
      ISS_ID:
        description: "Unique issuer identifier from source system"
        data_type: "VARCHAR(50)"
        business_meaning: "Issuer identifier"
        glossary_term: "Bond Issuer"
        
      ISS_NAME:
        description: "Issuer name - full name of the bond issuer"
        data_type: "VARCHAR(200)"
        business_meaning: "Full issuer name"
        
      ISS_TYPE:
        description: "Issuer type - opaque code from source system"
        data_type: "VARCHAR(50)"
        business_meaning: "Opaque code for issuer classification"
        
      STATE_CD:
        description: "State code - two-letter state abbreviation"
        data_type: "VARCHAR(2)"
        business_meaning: "State where issuer located"
        glossary_term: "Geographic Region"
        
      MUN_NAME:
        description: "Municipality name - city or municipality name"
        data_type: "VARCHAR(100)"
        business_meaning: "City or municipality name"
        
      RAW_INFO:
        description: "Raw JSON information from source system"
        data_type: "VARCHAR(MAX)"
        business_meaning: "Flexible storage for source system metadata"

stored_procedures:
  # ============================================================================
  # SQL SERVER STORED PROCEDURES - Data Transformation
  # ============================================================================
  
  - name: "dbo.sp_LoadTBL_0421"
    description: |
      Stored procedure that transforms and loads transaction data into TBL_0421.
      Processes raw transaction data from trading systems, applies transformations,
      and loads into the target table for Fivetran extraction.
      
      **Purpose**: Transform raw transaction data from trading systems into standardized
      format for ETL extraction. Applies data quality checks and transformations.
      
      **Data Flow**:
      - Source: External trading system feeds (staging table STG_TRANSACTIONS)
      - Transformation: This stored procedure
      - Target: dbo.TBL_0421
      - Extraction: Fivetran extracts from TBL_0421
      
      **Transformations**:
      - Validates transaction IDs
      - Standardizes date formats
      - Applies data quality checks
      - Handles null values
      - Transforms opaque codes
    business_purpose: |
      Transforms raw transaction data from trading systems into standardized format
      for ETL extraction to Snowflake.
    data_lineage: |
      External Trading Systems → sp_LoadTBL_0421 → dbo.TBL_0421 → Fivetran → BRZ_001.TX_0421
    usage_notes: |
      - Executed on schedule to load transaction data
      - Transforms raw data into standardized format
      - Prepares data for Fivetran extraction
      
  - name: "dbo.sp_LoadTBL_7832"
    description: |
      Stored procedure that transforms and loads bond reference data into TBL_7832.
      Processes raw bond reference data from reference systems, applies transformations,
      and loads into the target table for Fivetran extraction.
      
      **Purpose**: Transform raw bond reference data from reference systems into standardized
      format for ETL extraction. Applies data quality checks and transformations.
      
      **Data Flow**:
      - Source: External bond reference system feeds (staging table STG_BOND_REF)
      - Transformation: This stored procedure
      - Target: dbo.TBL_7832
      - Extraction: Fivetran extracts from TBL_7832
      
      **Transformations**:
      - Validates bond IDs
      - Standardizes date formats
      - Applies data quality checks
      - Handles null values
      - Transforms opaque issuer type codes
    business_purpose: |
      Transforms raw bond reference data from reference systems into standardized format
      for ETL extraction to Snowflake.
    data_lineage: |
      External Bond Reference Systems → sp_LoadTBL_7832 → dbo.TBL_7832 → Fivetran → BRZ_001.REF_7832
    usage_notes: |
      - Executed on schedule to load bond reference data
      - Transforms raw data into standardized format
      - Prepares data for Fivetran extraction
      
  - name: "dbo.sp_LoadTBL_5510"
    description: |
      Stored procedure that transforms and loads issuer information into TBL_5510.
      Processes raw issuer data from issuer reference systems, applies transformations,
      and loads into the target table for Fivetran extraction.
      
      **Purpose**: Transform raw issuer information from issuer reference systems into standardized
      format for ETL extraction. Applies data quality checks and transformations.
      
      **Data Flow**:
      - Source: External issuer reference system feeds (staging table STG_ISSUER_REF)
      - Transformation: This stored procedure
      - Target: dbo.TBL_5510
      - Extraction: Fivetran extracts from TBL_5510
      
      **Transformations**:
      - Validates issuer IDs
      - Standardizes issuer names
      - Applies data quality checks
      - Handles null values
      - Transforms opaque issuer type codes
    business_purpose: |
      Transforms raw issuer information from issuer reference systems into standardized format
      for ETL extraction to Snowflake.
    data_lineage: |
      External Issuer Reference Systems → sp_LoadTBL_5510 → dbo.TBL_5510 → Fivetran → BRZ_001.ISS_5510
    usage_notes: |
      - Executed on schedule to load issuer information
      - Transforms raw data into standardized format
      - Prepares data for Fivetran extraction

fivetran_connector:
  name: "sqlserver_to_snowflake_pimco"
  description: |
    Fivetran connector that extracts bond transaction, reference, and issuer data 
    from SQL Server source tables and loads into Snowflake Bronze layer.
    
    **Purpose**: ETL connector that synchronizes data from SQL Server source system 
    to Snowflake data warehouse for analytics and reporting.
    
    **Data Flow**:
    - Source: SQL Server database (dbo.TBL_0421, dbo.TBL_7832, dbo.TBL_5510)
    - Extraction: Fivetran extracts data from SQL Server tables
    - Transformation: Fivetran applies basic transformations during extraction
    - Destination: Snowflake PIMCO_DEMO database (BRZ_001.TX_0421, BRZ_001.REF_7832, BRZ_001.ISS_5510)
    
    **Configuration**:
    - Source: SQL Server database
    - Destination: Snowflake PIMCO_DEMO database
    - Sync frequency: Hourly
    - Sync mode: Incremental (based on transaction dates)
    
    **Tables Synced**:
    - dbo.TBL_0421 → BRZ_001.TX_0421 (transactions)
    - dbo.TBL_7832 → BRZ_001.REF_7832 (bond reference)
    - dbo.TBL_5510 → BRZ_001.ISS_5510 (issuer information)
  business_purpose: |
    ETL connector that synchronizes bond data from SQL Server source system to 
    Snowflake data warehouse for analytics and reporting.
  data_lineage: |
    SQL Server Tables (TBL_0421, TBL_7832, TBL_5510) → Fivetran → Snowflake Bronze (TX_0421, REF_7832, ISS_5510)
  usage_notes: |
    - Runs on hourly schedule
    - Incremental sync based on transaction dates
    - Handles schema changes automatically
    - Provides data quality monitoring

